import{m as _,a as M,Z as E,f as k,p as F,M as I,O as l,H as n,u as r,U as T,a2 as $}from"./framework.ByRx3r4Z.js";import{u as B}from"./TableLayout.CAtOvEvv.js";import{_ as C}from"./DialogLayout.vue_vue_type_script_setup_true_lang.CFAf_nn7.js";import{d as L}from"./utils.B11OKCkj.js";import{p as K,E as H}from"./theme.D1IV2eHo.js";const j=_({__name:"TableFormDialog",props:{layoutKey:{},showErrorMessage:{type:Boolean}},setup(g){const d=g,e=B(d.layoutKey),w=()=>{var o,a;if((a=(o=e.formRef)==null?void 0:o.value)==null||a.resetFields(),e.formData)for(const s in e.formData)e.formData[s]=void 0},t=M("add"),R=async()=>{var o,a;if(!((o=e.formRef)!=null&&o.value))throw new Error("formRef 未初始化");if(!e.saveMethod)throw new Error("未设置保存方法");try{await((a=e.formRef.value)==null?void 0:a.validate())}catch{return!1}await e.saveMethod({type:t.value,form:e.formData}),H.success("保存成功"),t.value==="edit"?e.refresh():e.reset()},f=M("");e.formDialog.open=async({type:o,row:a,title:s})=>{var c,p,h,i,v,D,y;t.value=o;let m={};if(o==="edit")f.value=s??"编辑",m=await((c=e.formInitMethod)==null?void 0:c.call(e,{type:o,row:a}))||a;else if(o==="add"){if(!await e.formInitMethod)return console.error("未设置表单初始化方法");f.value=s??"新增",m=await((p=e.formInitMethod)==null?void 0:p.call(e,{type:o,row:a}))||{}}else f.value=s??"查看",m=await((h=e.formInitMethod)==null?void 0:h.call(e,{type:o,row:a}))||a;e.formData=E(L(m)),(v=(i=u.value)==null?void 0:i.open)==null||v.call(i),(y=(D=e.formRef)==null?void 0:D.value)==null||y.resetFields()};const u=k({get:()=>e.formDialog.ref,set:o=>e.formDialog.ref=o});return(o,a)=>(F(),I(C,{ref_key:"dialogLayoutRef",ref:u,"cancel-method":w,"confirm-method":R,"show-error-message":d.showErrorMessage,title:r(f)},{header:l(()=>[n(o.$slots,"header",{form:r(e).formData,type:r(t)})]),footer:l(()=>[n(o.$slots,"footer",{form:r(e).formData,type:r(t)})]),default:l(()=>[T(r(K),{ref:r(e).formRef,"label-position":"top",rules:r(e).formRules||{},model:r(e).formData,onSubmit:a[0]||(a[0]=$(()=>{},["prevent"]))},{default:l(()=>[n(o.$slots,"default",{form:r(e).formData,type:r(t)})]),_:3},8,["rules","model"])]),_:3},8,["show-error-message","title"]))}});export{j as _};
